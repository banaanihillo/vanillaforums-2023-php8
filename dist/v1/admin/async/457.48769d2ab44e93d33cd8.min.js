"use strict";(self.webpackChunkvanillaadmin=self.webpackChunkvanillaadmin||[]).push([[457],{5981(e,t,n){n.d(t,{X:()=>o});var r=n(67294),a=n(94184),i=n.n(a);function o(e){return r.createElement("li",null,r.createElement("h2",Object.assign({},e,{className:i()("subheading",e.className)})))}},90934(e,t,n){n.d(t,{Mr:()=>E,fn:()=>m,iS:()=>b,pj:()=>v});var r=n(67294),a=n(86434),i=n(80720),o=n(47178),l=n(98769),c=n(89718);function s(e,t,n,r,a,i,o){try{var l=e[i](o),c=l.value}catch(s){n(s);return}l.done?t(c):Promise.resolve(c).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){s(i,r,a,o,l,"next",e)}function l(e){s(i,r,a,o,l,"throw",e)}o(void 0)})}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){p(e,t,n[t])})}return e}function m(e){var t,n;let a=(0,i.pv)(),s=e?(0,l.Q6)(e):"",u=(0,i.Fu)(({authenticators:{authenticatorIDsByHash:e}})=>e),p=(0,i.Fu)(({authenticators:{authenticatorsByID:e}})=>e),m=u[s],h=(0,r.useMemo)(()=>{if(m&&m.status===o.Px.SUCCESS)return{items:m.data.items.map(e=>p[e]),pagination:m.data.pagination}},[m,p]);return(0,r.useEffect)(()=>{e&&!m&&a((0,c.y6)(e))},[a,m,e]),t=d({},m),n=(n={data:h},n),Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t}let h={scope:"",prompt:a.m.LOGIN},f={authenticatorID:void 0,name:"",clientID:"",secret:"",type:"oauth2",urls:{},userMappings:{uniqueID:"user_id",email:"email",name:"displayname",fullName:"name",photoUrl:"picture",roles:"roles"},authenticationRequest:h,useBearerToken:!1,useBasicAuthToken:!1,postProfileRequest:!1,allowAccessTokens:!1,active:!0,default:!1,visible:!0};function b(e){var t;let n=(0,i.pv)(),a=(0,i.Fu)(({authenticators:{authenticatorsByID:t}})=>e?t[e]:void 0);(0,r.useEffect)(()=>{e&&n((0,c.DE)(e))},[n,e]);let o=(0,r.useCallback)((t=u(function*(t){return n(e?(0,c.t$)(t):(0,c.GX)(t))}),function(e){return t.apply(this,arguments)}),[e,n]),l=d({},f,a);return{initialValues:l,submitForm:o}}function E(){var e;let t=(0,i.pv)(),n=(0,r.useCallback)((e=u(function*(e,n){yield t((0,c.um)({authenticatorID:e,active:n}))}),function(t,n){return e.apply(this,arguments)}),[t]);return n}function v(e){let t=(0,i.Fu)(({authenticators:{deleteState:e}})=>e),n=(0,i.pv)(),a=(0,r.useCallback)(u(function*(){yield n((0,c.Ul)(e))}),[n,e]);return{deleteState:t,deleteAuthenticator:a}}},86434(e,t,n){var r,a;n.d(t,{m:()=>r}),(a=r||(r={})).CONSENT="consent",a.CONSENT_AND_LOGIN="consent and login",a.LOGIN="login",a.NONE="none"},2457(e,t,n){n.r(t),n.d(t,{default:()=>L});var r=n(98178),a=n(5909),i=n(5981),o=n(35731),l=n(48654),c=n(17903),s=n(30731),u=n(33188),p=n(64166),d=n(14698),m=n(24462),h=n(10914),f=n(51250),b=n(57298),E=n(79089),v=n(90934),g=n(86434),y=n(52303),O=n(67294),D=n(24504),P=n(79454),k=n(27361),T=n.n(k),C=n(36968),S=n.n(C),A=n(87219),w=n(75864);let I=(0,w.yI)(()=>{let e=(0,w.Y7)("authenticatorAddEdit"),t=e("bodyWrap",{overflowX:"hidden"});return{bodyWrap:t}});var N=n(41054),U=n(23675),R=n(46452),j=n(81612);function q(e,t,n,r,a,i,o){try{var l=e[i](o),c=l.value}catch(s){n(s);return}l.done?t(c):Promise.resolve(c).then(r,a)}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e){var t,n;let r=I(),a=(0,D.UO)(),{onClose:i}=e,o=e.authenticatorID||(a.authenticatorID?parseInt(a.authenticatorID):void 0),l=(0,E.hu)("Oauth2Connection"),{initialValues:c,submitForm:m}=(0,v.iS)(o),[b,g]=(0,O.useState)(void 0),{handleSubmit:P,values:k,isSubmitting:T,setValues:C}=(0,N.TA)({initialValues:c,enableReinitialize:!0,onSubmit:(n=(t=function*(e){try{let t=yield m(e);(0,U.SI)(t),i()}catch(n){g(n)}},function(){var e=this,n=arguments;return new Promise(function(r,a){var i=t.apply(e,n);function o(e){q(i,r,a,o,l,"next",e)}function l(e){q(i,r,a,o,l,"throw",e)}o(void 0)})}),function(e){return n.apply(this,arguments)})});function S(e){C(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){M(e,t,n[t])})}return e}({},k,e))}return O.createElement("form",{onSubmit:P},O.createElement(p.Z,{header:O.createElement(d.Z,{titleID:l,closeFrame:i,title:(0,y.t)("OAuth Connection"),borderless:!0}),bodyWrapClass:r.bodyWrap,body:O.createElement(f.m,{extendContainer:!0,data:[{label:"OAuth Settings",panelData:"",contents:O.createElement(W,{values:k,formErrors:b,fieldErrors:null==b?void 0:b.errors,update:S})},{label:"General SSO Settings",panelData:"",contents:O.createElement(Z,{values:k,formErrors:b,fieldErrors:null==b?void 0:b.errors,update:S})}]}),footer:O.createElement("div",{className:"Buttons form-footer padded-right"},O.createElement(s.Z,{submit:!0,buttonType:u.q.DASHBOARD_PRIMARY,disabled:T},T?O.createElement(h.Z,null):(0,y.t)("Save")))}))}function W(e){var t;let{values:n,update:s,formErrors:u,fieldErrors:p}=e,d=(0,b.or)("/entry/oauth2"),h=O.createElement(c.Z,{source:"Configure your forum to connect with an OAuth 2 application by putting your unique Client ID, Client, Secret, and required endpoints. You will probably need to provide your SSO application with an allowed callback URL, in part, to validate requests. The callback url for this forum is <0/>",c0:()=>O.createElement("a",{href:d},(0,b.or)(d))}),f=Object.entries(g.m).map(([e,t])=>({label:t,value:e})),E=(e,t=!1)=>({value:T()(n,e)||"",onChange(r){let{value:a}=r.target,i=(0,A.ZP)(n,n=>{""===a&&t?S()(n,e,null):S()(n,e,a)});s(i)}});return O.createElement("div",{className:"padded-left padded-right"},O.createElement("div",{className:"padded-bottom padded-top"},O.createElement(m.Z,null,h)),!!(null==u?void 0:u.message)&&O.createElement("div",{className:"padded-bottom padded-top"},O.createElement(R.Z,{icon:O.createElement(j.Pz,null),stringContents:u.message})),O.createElement(i.X,null,(0,y.t)("OAuth Configuration")),O.createElement(r.r,{label:(0,y.t)("Client ID"),description:(0,y.t)("Unique ID of the authentication application.")},O.createElement(o.D,{errors:null==p?void 0:p.clientID,inputProps:E("clientID")})),O.createElement(r.r,{label:(0,y.t)("Name"),description:(0,y.t)("The name of the connection. This is displayed on some pages.")},O.createElement(o.D,{errors:null==p?void 0:p.name,inputProps:E("name")})),O.createElement(r.r,{label:(0,y.t)("Secret"),description:(0,y.t)("Secret provided by the authentication provider.")},O.createElement(o.D,{errors:null==p?void 0:p.secret,inputProps:E("secret")})),O.createElement(r.r,{label:(0,y.t)("Authorize URL"),description:(0,y.t)("URL where users sign-in with the authentication provider.")},O.createElement(o.D,{errors:null==p?void 0:p.authorizeUrl,inputProps:E("urls.authorizeUrl",!0)})),O.createElement(r.r,{label:(0,y.t)("Token URL"),description:(0,y.t)("Endpoint to retrieve the access token for a user.")},O.createElement(o.D,{errors:null==p?void 0:p.tokenUrl,inputProps:E("urls.tokenUrl",!0)})),O.createElement(r.r,{label:(0,y.t)("Register URL"),description:(0,y.t)("Enter the endpoint to direct a user to register.")},O.createElement(o.D,{inputProps:E("urls.registerUrl",!0)})),O.createElement(r.r,{label:(0,y.t)("Sign Out URL"),description:(0,y.t)("Enter the endpoint to log a user out.")},O.createElement(o.D,{inputProps:E("urls.signOutUrl",!0)})),O.createElement(r.r,{label:(0,y.t)("This is an OIDC Connection"),description:(0,y.t)("This connection should use OIDC ID Token instead of a profile URL.")},O.createElement(l.A,{checked:null!==(t=n.isOidc)&&void 0!==t&&t,onChange(e){s({isOidc:e})}})),!n.isOidc&&O.createElement(r.r,{label:(0,y.t)("Profile URL"),description:(0,y.t)("Endpoint to retrieve a user's profile.")},O.createElement(o.D,{errors:null==p?void 0:p.profileUrl,inputProps:E("urls.profileUrl",!0)})),O.createElement(i.X,null,(0,y.t)("Advanced Settings")),O.createElement(r.r,{label:(0,y.t)("Request Scope"),description:(0,y.t)("Enter the scope to be sent with token requests.")},O.createElement(o.D,{errors:null==p?void 0:p.scope,inputProps:E("authenticationRequest.scope")})),O.createElement(r.r,{label:(0,y.t)("Prompt"),description:(0,y.t)("Prompt parameter set with authorize requests.")},O.createElement(P.F,{options:f,value:f.find(e=>e.label===n.authenticationRequest.prompt),onChange(e){s({authenticationRequest:{prompt:(null==e?void 0:e.label)?e.label:void 0}})}})),O.createElement(r.r,{label:(0,y.t)("Authorization Code in Header"),description:O.createElement(c.Z,{source:"When requesting the profile, pass the access token in the HTTP header.<0/>i.e Authorization: Bearer [accesstoken]",c0:()=>O.createElement("br",null)}),labelType:a.C.WIDE},O.createElement(l.A,{onChange(e){s({useBearerToken:e})},checked:n.useBearerToken||!1})),O.createElement(r.r,{label:(0,y.t)("Basic Authorization Code in Header"),description:O.createElement(c.Z,{source:"When requesting the Access Token, pass the basic Auth token in the HTTP header. i.e Authorization:  [Authorization =\\> Basic base64_encode($rawToken)]",c0:()=>O.createElement("br",null)}),labelType:a.C.WIDE},O.createElement(l.A,{onChange(e){s({useBasicAuthToken:e})},checked:n.useBasicAuthToken||!1})),O.createElement(r.r,{label:(0,y.t)("Request Profile Using the POST Method"),description:O.createElement(c.Z,{source:"When requesting the profile, use the HTTP POST method (default method is GET).",c0:()=>O.createElement("br",null)}),labelType:a.C.WIDE},O.createElement(l.A,{onChange(e){s({postProfileRequest:e})},checked:n.postProfileRequest||!1})),O.createElement(r.r,{label:(0,y.t)("Allow Access Tokens"),description:(0,y.t)("Allow this connection to issue API access tokens."),labelType:a.C.WIDE},O.createElement(l.A,{onChange(e){s({allowAccessTokens:e})},checked:n.allowAccessTokens||!1})))}function Z(e){let{values:t,update:n,fieldErrors:c}=e,s=e=>({value:T()(t,e)||"",onChange(r){let{value:a}=r.target,i=(0,A.ZP)(t,t=>{S()(t,e,a)});n(i)}});return O.createElement("div",{className:"padded-left padded-right"},O.createElement(i.X,null,(0,y.t)("User Mapping")),O.createElement(r.r,{label:(0,y.t)("User ID"),description:(0,y.t)("The key in the JSON array to designate user ID.")},O.createElement(o.D,{errors:null==c?void 0:c.uniqueID,inputProps:s("userMappings.uniqueID")})),O.createElement(r.r,{label:(0,y.t)("Email"),description:(0,y.t)("The key in the JSON array to designate emails.")},O.createElement(o.D,{errors:null==c?void 0:c.email,inputProps:s("userMappings.email")})),O.createElement(r.r,{label:(0,y.t)("Display Name"),description:(0,y.t)("The key in the JSON array to designate display name.")},O.createElement(o.D,{inputProps:s("userMappings.name")})),O.createElement(r.r,{label:(0,y.t)("Full Name"),description:(0,y.t)("The key in the JSON array to designate full name.")},O.createElement(o.D,{inputProps:s("userMappings.fullName")})),O.createElement(r.r,{label:(0,y.t)("Photo"),description:(0,y.t)("The key in the JSON array to designate photo URL.")},O.createElement(o.D,{inputProps:s("userMappings.photoUrl")})),O.createElement(r.r,{label:(0,y.t)("Roles"),description:(0,y.t)("The key in the JSON array to designate roles.")},O.createElement(o.D,{inputProps:s("userMappings.roles")})),O.createElement(i.X,null,(0,y.t)("Other Settings")),O.createElement(r.r,{label:(0,y.t)("Visible"),description:(0,y.t)("This connection is visible on the sign in page."),labelType:a.C.WIDE},O.createElement(l.A,{onChange(e){n({visible:e})},checked:t.visible||!1})),O.createElement(r.r,{label:(0,y.t)("Default"),description:(0,y.t)("Make this connection your default signin method."),labelType:a.C.WIDE},O.createElement(l.A,{onChange(e){n({default:e})},checked:t.default||!1})))}}}]);