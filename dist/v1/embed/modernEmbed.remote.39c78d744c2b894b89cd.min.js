var e;(()=>{"use strict";var e={};e.d=(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{VanillaEmbedElement:()=>r});class r extends HTMLElement{getFrameSource(){var e,t,r;this.ssoString=null!==(t=null!==(e=this.getAttribute("sso-string"))&&void 0!==e?e:window.vanilla_sso)&&void 0!==t?t:null;let i=window.location.hash.replace(/^#/,"").trim(),s=0===i.length&&this.getAttribute("initial-path")?this.createFrameUrl(null!==(r=this.getAttribute("initial-path"))&&void 0!==r?r:"/"):this.currentFrameUrlFromHash();if(this.ssoString){let l=new URL(s),a=new URLSearchParams(l.search);return a.set("sso",this.ssoString),`${s.split("?")[0]}?${a.toString()}`}return s}connectedCallback(){if(this.remoteUrl=this.getAttribute("remote-url"),!this.remoteUrl)throw Error("You must define a remote url");this.remoteUrl.replace(/\/$/,"");let e=new URL(this.remoteUrl);this.remoteOrigin=e.origin,this.position=this.validatePosition(),this.scrollOffseter=document.createElement("div"),this.appendChild(this.scrollOffseter),this.iframe=document.createElement("iframe"),this.iframe.src=this.getFrameSource(),this.handleUpdate({type:"embeddedHrefUpdate",href:this.iframe.src,force:!0}),this.iframe.width="100%",this.iframe.style.height="100vh",this.iframe.style.border="none",this.iframe.style.width="100%",this.iframe.style.background="#fff",this.iframe.style.position="relative",this.iframe.style.transition="margin 0.5s ease-in-out",this.iframe.style.willChange="margin",this.appendChild(this.iframe),window.addEventListener("message",this.postMessageHandler),window.addEventListener("hashchange",this.hashChangeHandler)}disconnectedCallback(){window.removeEventListener("message",this.postMessageHandler),window.removeEventListener("hashchange",this.hashChangeHandler)}validateEvent(e){let t="object"==typeof e&&null!==e&&"type"in e;return t||console.error("Event was not an embedEvent",{maybeEvent:e}),t}constructor(...e){super(...e),this.validatePosition=()=>{var e;let t=null!==(e=this.getAttribute("position"))&&void 0!==e?e:"sticky";switch(t){case"sticky":case"static":return t;default:return console.error("Invalid 'position' property for VanillaEmbed. Only 'static' and 'sticky' are allowed. Falling back to 'sticky'."),"sticky"}},this.postMessageHandler=e=>{(e.origin===this.remoteOrigin||""===e.origin)&&this.validateEvent(e.data)&&this.handleUpdate(e.data)},this.hashChangeHandler=e=>{if(this.state.currentFrameUrl===this.currentFrameUrlFromHash())return;this.state.currentFrameUrl=this.currentFrameUrlFromHash();let t=this.iframe.cloneNode(!0);t.src=this.currentFrameUrlFromHash(),this.iframe.replaceWith(t),this.iframe=t},this.state={isScrolled:!1,currentFrameUrl:"",lastScrollEvent:null},this.handleUpdate=e=>{switch(e.type){case"embeddedHrefUpdate":{let t=e.href.replace(/\/$/,"");if(this.state.currentFrameUrl=t,e.force||t!==this.currentFrameUrlFromHash()){let r=t.split("?"),i=r[0].replace(this.remoteUrl,""),s="";if(r[1]&&r[1].length>0){let l=new URLSearchParams(r[1]);l.delete("sso"),s=`?${l.toString()}`}window.location.hash=escape(`${i}${s}`)}break}case"embeddedScrollUpdate":if("static"===this.position||this.state.lastScrollEvent&&this.state.lastScrollEvent.isScrollEnd===e.isScrollEnd&&this.state.lastScrollEvent.isScrolled===e.isScrolled)return;if(this.state.lastScrollEvent=e,e.isScrolled){let a=this.scrollOffseter.getBoundingClientRect().top,n=document.scrollingElement.scrollTop,o=a+n;this.iframe.style.marginTop=`-${o}px`,e.isScrollEnd?document.scrollingElement.scrollTo({top:document.scrollingElement.scrollHeight,behavior:"smooth"}):document.scrollingElement.scrollTo({top:0,behavior:"smooth"})}else this.iframe.style.marginTop="0px",document.scrollingElement.scrollTo({top:0,behavior:"smooth"});break;case"embeddedTitleUpdate":document.title=e.title;break;case"navigateExternalDomain":window.location.href=e.href;break;default:console.error("Received an unknown event",e)}},this.createFrameUrl=e=>`${this.remoteUrl}${e=(e=e.replace(/^http:\/\//,"https://")).replace(this.remoteUrl,"").replace(unescape(escape(this.remoteUrl)),"")}`,this.currentFrameUrlFromHash=()=>{let e=window.location.hash,t=e.replace(/^#/,""),r=unescape(t);return this.createFrameUrl(r)}}}customElements.define("vanilla-embed",r)})();